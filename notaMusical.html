<!DOCTYPE HTML>
<!Adaptado de Gregory Dyke e Paul Rosen.>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Escritor Musical</title>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
	<link href="abcjs-midi.css" media="all" rel="stylesheet" type="text/css" />
	<script src="abcjs_editor_midi_3.1.3-min.js" type="text/javascript"></script>
        <script type="text/javascript"> window.ABCJS.midi.soundfontUrl = "soundfont/"; </script>
        <script src="./gramatica/parser.js"></script>
        <script src="./tradutor/escritorAbc.js"></script>
	<style>
		.abcjs-inline-midi {
			max-width: 740px;
		}
	</style>
        
    
     <style>
    body {
    background-image: url("img/background3.jpg");
    background-repeat: repeat;
    background-position: center;
    background-attachment: fixed;
    background-size: 1920px 1200px
}
textarea#note {
	width:100%;
        resize: both;
}
    </style>
</head>


<h1 style="text-align:left;font-family:verdana;color: whitesmoke">Music Writer
    
</h1>
<div>
<table style="width:100%">
    <tr>
        <th>
<textarea name="area" id="area" cols="80" rows="15" onkeyup="processarTxt(this)" style="height: 100%">

Titulo: Doremifá
Compositor: Gabriel
Tempo: 4/4
Nota: 1/4

do re mi faa fa faa do re do ree re ree do sol fa mii mi mii do re mi faa fa faa   
</textarea>


<! textarea escondida para receber a traducao e repassar para o abc.js realizar o desenho e gerar o arquivo midi>
<textarea name="abc" id="abc" cols="80" rows="15" style="height: 100%;display:none">
X: 1
T: Doremifá
C: Gabriel
M: 4/4
L: 1/4
C D E F-|F F F2 | C D C D-|D D D2 | 
C G F E-|E E E2 | C D E F-|F F F2 |]
</textarea>
</th>

<th>
<div id="paper0"></div>
<!id to drawnin>
<div id="paper1"></div>
<!id to drawnin>
<div id="paper2"></div>
<!id to drawnin>
<div id="paper3"></div>
</th>
</tr>
</table>
</div>


<hr />
<!control midi panel>
<div id="midi"></div>
<!link para download>
<div id="midi-download"></div> 
<!Place the warnings>
<div id="warnings"></div>
<div id="music"></div>
<!id to drawnin>
<div id="selection"></div>


<footer>
<p>Para a renderização e audio, utilizamos o <a href="https://github.com/paulrosen/abcjs">abc.js</a>, de Gregory Dyke e Paul Rosen. </p>
</footer>



<script type="text/javascript">
	function selectionCallback(abcelem) {
		var note = {};
		for (var key in abcelem) {
			if (abcelem.hasOwnProperty(key) && key !== "abselem")
				note[key] = abcelem[key];
		}
		console.log(abcelem);
		var el = document.getElementById("selection");
		el.innerHTML = "<b>selectionCallback parameter:</b><br>" + JSON.stringify(note);
	}
var abcjs;
	function initEditor() {
		abcjs = new ABCJS.Editor("abc", { paper_id: "paper0",
			generate_midi: true,
			midi_id:"midi",
			midi_download_id: "midi-download",
			generate_warnings: true,
			warnings_id:"warnings",
			midi_options: {
				generateDownload: true
			},
			render_options: {
				listener: { highlight: selectionCallback }
			}
		});
	}
        //Funcao para ler a traducao e atualizar o desenho da partitura e o arquivo midi
        //Funcao que integra o parser com o desenho da partitura e o arquivo midi.
        function processarTxt(element){
            console.log(element.value);
            document.getElementById("abc").value = traduzirAbc(arvoreLexical.parse(element.value));
            console.log(document.getElementById("abc").value);
            abcjs.fireChanged();
        }

	window.addEventListener("load", initEditor, false);
</script>

</html>

